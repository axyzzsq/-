# H264专题-帧内预测

## 4×4亮度块的帧内预测模式

### DC模式

![image-20230412211730217](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20230412211730217.png)

- H264帧内预测当上边块和左边块都存在的时候，预测块像素的计算方法：

  ```mathematica
  pred[ x, y]= (p[ 0, -1] + p[ 1, -1] + [ 2, -1] + p[ 3, -1] + p[ -1, 0]+ p[ -1, 1] + p[ -1, 2] + p[ -1, 3] + 4) >> 3
  ```

  - `>>3`运算:除以8，求8个像素的均值
  - 像素值求和`+4`的原因：防止出现负值
  - 预测后的整个P块的像素值是一样的

### Diagonal Down-Left 模式

![image-20230412212809470](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20230412212809470.png)

Diagonal Down-Left 模式是上边块和右上块（上边块和右上块有可能是一个块，因为可能是一个 16 x 16 的亮度块，意思理解就可以）的像素通过插值得到。如果上边块和右上块不存在则该模式无效。

- 第一种情况，对于4 x 4块最右下角的像素，计算方法如下

  ```mathematica
  pred[3,3] = ( p[ 6, -1] + 3 * p[ 7, -1] + 2 ) >> 2
  ```

  - 乘以3和+2是为了对`p[7,-1]`像素赋予更高的重要性
  
- 其他情况见极客时间。

## 16×16亮度块的帧内预测模式

一共有4种，Vertical模式、Horizontal模式、DC模式和Plane模式。

Plane模式的示意图:

![image-20230413161039084](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20230413161039084.png)

![image-20230413044226814](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20230413044226814.png)

- H和V分别是横向和纵向方向的梯度
- 在H264编码中，Plane预测模式是通过对左侧和上侧的像素进行线性回归来预测当前块的像素值。具体地，Plane预测模式是通过计算当前块左侧和上侧像素的梯度来确定一个平面，然后使用该平面来预测当前块的像素值。因此，Plane预测模式被称为线性回归预测模式。

## 8×8色度块的帧内预测模式

略。



##  帧内预测模式的选择

待编码块的原始像素减去预测块的像素得到残差块。

![image-20230413202228640](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20230413202228640.png)
